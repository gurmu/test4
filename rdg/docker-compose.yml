version: '3.8'

services:
  teams-bot:
    image: ${ACR_LOGIN_SERVER:-local}/teams-bot:${IMAGE_TAG:-latest}
    restart: always
    ports:
      - "3978"
    environment:
      AZURE_AUTHORITY_HOST: ${AZURE_AUTHORITY_HOST}
      AZURE_OPENAI_ENDPOINT: ${AZURE_OPENAI_ENDPOINT}
      AZURE_OPENAI_DEPLOYMENT: ${AZURE_OPENAI_DEPLOYMENT}
      AZURE_OPENAI_API_VERSION: ${AZURE_OPENAI_API_VERSION}
      AZURE_OPENAI_API_KEY: ${AZURE_OPENAI_API_KEY}
      AZURE_OPENAI_EMBEDDING_DEPLOYMENT: ${AZURE_OPENAI_EMBEDDING_DEPLOYMENT}
      AZURE_SEARCH_ENDPOINT: ${AZURE_SEARCH_ENDPOINT}
      AZURE_SEARCH_INDEX: ${AZURE_SEARCH_INDEX}
      AZURE_SEARCH_KEY: ${AZURE_SEARCH_KEY}
      KB_TOP_K: ${KB_TOP_K}
      KB_CONTENT_FIELD: ${KB_CONTENT_FIELD}
      KB_SEMANTIC_CONFIG: ${KB_SEMANTIC_CONFIG}
      COSMOSDB_ENDPOINT: ${COSMOSDB_ENDPOINT}
      COSMOSDB_KEY: ${COSMOSDB_KEY}
      COSMOSDB_DATABASE: ${COSMOSDB_DATABASE}
      COSMOSDB_CONTAINER: ${COSMOSDB_CONTAINER}
      MICROSOFT_APP_ID: ${MICROSOFT_APP_ID}
      MICROSOFT_APP_PASSWORD: ${MICROSOFT_APP_PASSWORD}
      BOT_TYPE: ${BOT_TYPE}
      APP_MSI_RESOURCE_ID: ${APP_MSI_RESOURCE_ID}
      BOT_FRAMEWORK_CHANNEL_SERVICE: ${BOT_FRAMEWORK_CHANNEL_SERVICE}
      BOT_FRAMEWORK_OAUTH_URL: ${BOT_FRAMEWORK_OAUTH_URL}
      IVANTI_API_URL: ${IVANTI_API_URL}
      NICE_API_URL: ${NICE_API_URL}
      PORT: ${WEBSITES_PORT:-3978}

  ivanti-api:
    image: ${ACR_LOGIN_SERVER:-local}/ivanti-api:${IMAGE_TAG:-latest}
    restart: always
    environment:
      PORT: "8000"

  nice-api:
    image: ${ACR_LOGIN_SERVER:-local}/nice-api:${IMAGE_TAG:-latest}
    restart: always
    environment:
      PORT: "8001"
